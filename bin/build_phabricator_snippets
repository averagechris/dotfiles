#! /usr/bin/env python3

import glob
import os
import sys

template = """# -*- mode: snippet -*-
# name: {name}
# key: phab {name}
# --
{name}
"""

home = os.environ.get("HOME")
dotfiles = os.environ.get("DOTFILES")
load_path = f"{home}/.evbdevtools/phabricator_users.txt"
save_dir = f"{dotfiles}/spacemacs/snippets/phabricator/"

if not os.path.exists(load_path):
    print("phabricator_users.txt is required, but does not exist.", file=sys.stderr)
    sys.exit(1)

prefix = "phabricator_username_"

with open(load_path) as f:
    users = f.readlines()

for old_snippet_file in glob.glob("{}{}*".format(save_dir, prefix)):
    os.remove(old_snippet_file)

for name in users:
    name = name.strip()
    save_path = f"{save_dir}{prefix}{name}"
    with open(save_path.format(name=name), mode="w") as f:
        f.write(name)

print(f"Updated snippets for {len(users)} users.")
